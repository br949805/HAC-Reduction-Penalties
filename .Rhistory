text(4.8,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
text(4.8,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
cmi_hac_aha$bed.size.text <- ifelse(cmi_hac_aha$bed.size == 1,">= 400 Beds","< 400 Beds")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size.text)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
cmi_hac_aha$bed.size.text <- ifelse(cmi_hac_aha$bed.size == 1,">= 400 Beds","< 400 Beds")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size.text, main="Hospitals Size vs HAC Reduction Program Score", ylab="Scores")
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
cmi_hac_aha$MAPP8.BINARY.text <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MAPP8.BINARY.text)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MAPP8.BINARY == 0],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MAPP8.BINARY == 1],)))
View(cmi_hac_aha)
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Other"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Teaching"],)))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Other"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING)
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
text(c(0,6.75),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING)
text(c(0,6.7),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING,  main="Teaching Status vs Reduction Program Score", ylab="Scores")
text(c(0,6.7),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
lm(cmi_hac_aha$SCORE ~ cmi_hac_aha$MAPP8.BINARY + cmi_hac_aha$bed.size)
lin.model <- lm(cmi_hac_aha$SCORE ~ cmi_hac_aha$MAPP8.BINARY + cmi_hac_aha$bed.size)
summary(lin.model)
cor(cmi_hac_aha)
cor(cmi_hac_aha$score,cmi_hac_aha$bed.size)
cor(cmi_hac_aha$score,cmi_hac_aha$HOSPBDS)
View(cmi_hac_aha)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,0,5,5, col="red")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,0,5,5, col=col2alpha("red", alpha = 0.5)")
rect(0,0,5,5, col=col2alpha(red, alpha = 0.5)")
rect(0,0,5,5, col=col2alpha(red, alpha = 0.5))
install.packages("seqinr")
library(seqinr)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,0,5,5, col=col2alpha(red, alpha = 0.5))
rect(0,0,5,5, col=col2alpha("red", alpha = 0.5))
rect(7,7,11,11, col=col2alpha("red", alpha = 0.5))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(7,7,11,11, col=col2alpha("red", alpha = 0.5))
rect(7,7,10,10, col=col2alpha("red", alpha = 0.5))
rect(0,0,10,10, col=col2alpha("red", alpha = 0.5))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(1,0,10,10, col=col2alpha("red", alpha = 0.5))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,1,10, col=col2alpha("red", alpha = 0.5))
rect(0,7,2,10, col=col2alpha("red", alpha = 0.5))
rect(0,7,4,10, col=col2alpha("red", alpha = 0.5))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.5))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.5))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.3))
text(c(1.5,9),"Penalized")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.3))
text(1.5,9,"Penalized")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.3))
text(1.5,9,"Penalized", cex=2)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member HAC Reduction Program Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.3))
text(1.5,9,"Penalized", cex=1.5)
plot(cmi_hac_aha$SCORE ~ cmi_hac_aha$HOSPBD)
sample(0:1,nrows(cmi_hac_aha$score))
sample(0:1,nrow(cmi_hac_aha$score))
sample(0:1,nrows(cmi_hac_aha$score))
sample(0:1,nrow(cmi_hac_aha$score))
nrow(cmi_hac_aha$score)
sample(0:1,nrow(cmi_hac_aha$SCORE))
nrow(cmi_hac_aha$SCORE)
View(cmi_hac_aha)
nrow(cmi_hac_aha$PENALIZED)
nrow(cmi_hac_aha)
sample(0:1,nrow(cmi_hac_aha))
sample(0:1,nrow(cmi_hac_aha), replace=T)
cmi_hac_aha$Test.Set <- sample(0:1,nrow(cmi_hac_aha), replace=TRUE)
View(cmi_hac_aha)
plot(subset(cmi_test_aha$SCORE,cmi_test_aha$Test.Set == 1) ~ subset(cmi_test_aha$HOSPBD,cmi_test_aha$Test.Set == 1))
plot(subset(cmi_hac_aha$SCORE,cmi_test_aha$Test.Set == 1) ~ subset(cmi_hac_aha$HOSPBD,cmi_test_aha$Test.Set == 1))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=10) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100))
plot(cmi_hac_aha$SCORE ~ cmi_hac_aha$HOSPBD)
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=10) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=100))
plot(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400))
cor(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400))
cor(subset(cmi_hac_aha$SCORE,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400) ~ subset(cmi_hac_aha$HOSPBD,cmi_hac_aha$Test.Set == 1 & cmi_hac_aha$HOSPBD >=400))
summary(lin.model)
plot(cmi_hac_aha$SCORE)
plot(cmi_hac_aha$SCORE ~ cmi_hac_aha$PENALIZED)
table(cmi_hac_aha$SCORE ~ cmi_hac_aha$PENALIZED)
table(cmi_hac_aha$SCORE, cmi_hac_aha$PENALIZED)
table(cmi_hac_aha$PENALIZED, cmi_hac_aha$SCORE)
plot(complete.cases(cmi_hac_aha$SCORE ~ cmi_hac_aha$PENALIZED))
plot(cmi_hac_aha$SCORE ~ cmi_hac_aha$PENALIZED, na.rm=T)
x <- subset(cmi_hac_aha$PENALIZED, cmi_hac_aha$PENALIZED == "N.A.")
x
cmi_hac_aha$PENALIZED <- ifelse(cmi_hac_aha$PENALIZED == "N.A.",NA,cmi_hac_aha$PENALIZED)
View(cmi_hac_aha)
table(cmi_hac_aha$PENALIZED)
setwd("~/R/Regression Example")
library(RODBC)
library(seqinr)
#Connect to SQL Databases and read in data
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha <- sqlQuery(con,"select t1.ID,MNAME, MCRNUM, MAPP8, MAPP5, t2.HOSPBD  from AS12DEM t1 inner join as12svc1 t2 on t1.id = t2.id")
odbcClose(con)
rm(con)
con <- odbcConnect("MemberList",uid="SASUser", pwd="EHI1301a")
mem <- sqlQuery(con,"select * from AEH_Current_Members")
odbcClose(con)
rm(con)
con <- odbcConnect("IPPSData",uid="SASUser", pwd="EHI1301a")
cmi <- sqlQuery(con,"select PROVIDER_NUMBER, HOSPITAL, TACMIV31 from FY2014IMPACT")
odbcClose(con)
rm(con)
#Read in HAC_Data.csv; rename matching variables in data frames
names(aha) <- c("ID","MNAME","PROVIDER_NUMBER", "MAPP8", "MAPP5", "HOSPBD")
aha$bed.size <- ifelse(aha$HOSPBD >= 400,1,0)
hac <- read.csv("HAC_Data.csv")
names(hac) <- c("PROVIDER_NUMBER","PENALIZED", "SCORE")
mem <- as.data.frame(mem[,c("MCRNUM","MNAME")])
names(mem) <- c("PROVIDER_NUMBER","MNAME")
#Merge data frames
cmi_hac <- merge(hac, cmi, by="PROVIDER_NUMBER")
cmi_hac_aha <- merge(cmi_hac, aha, by="PROVIDER_NUMBER")
#Recode PENALIZED Variable
cmi_hac_aha$PENALIZED.BINARY <- ifelse(cmi_hac_aha$PENALIZED == "Y",1,cmi_hac_aha$PENALIZED)
cmi_hac_aha$PENALIZED.BINARY <- ifelse(cmi_hac_aha$PENALIZED == "N.A.",NA,cmi_hac_aha$PENALIZED)
cmi_hac_aha$PENALIZED.BINARY <- ifelse(cmi_hac_aha$PENALIZED == "N",0,cmi_hac_aha$PENALIZED)
#Recode MAPP8 and MAPP5
cmi_hac_aha$MAPP8.BINARY <- ifelse(cmi_hac_aha$MAPP8 == 2,0,1)
cmi_hac_aha$MAPP5.BINARY <- ifelse(cmi_hac_aha$MAPP5 == 2,0,1)
cmi_hac_aha$Test.Set <- sample(0:1,nrow(cmi_hac_aha), replace=TRUE)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MAPP8.BINARY)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MAPP8.BINARY)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
View(cmi_hac_aha)
table(cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY)
View(cmi_hac)
View(cmi_hac_aha)
setwd("~/R/Regression Example")
library(RODBC)
library(seqinr)
#Connect to SQL Databases and read in data
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha <- sqlQuery(con,"select t1.ID,MNAME, MCRNUM, MAPP8, MAPP5, t2.HOSPBD  from AS12DEM t1 inner join as12svc1 t2 on t1.id = t2.id")
odbcClose(con)
rm(con)
con <- odbcConnect("MemberList",uid="SASUser", pwd="EHI1301a")
mem <- sqlQuery(con,"select * from AEH_Current_Members")
odbcClose(con)
rm(con)
con <- odbcConnect("IPPSData",uid="SASUser", pwd="EHI1301a")
cmi <- sqlQuery(con,"select PROVIDER_NUMBER, HOSPITAL, TACMIV31 from FY2014IMPACT")
odbcClose(con)
rm(con)
#Read in HAC_Data.csv; rename matching variables in data frames
names(aha) <- c("ID","MNAME","PROVIDER_NUMBER", "MAPP8", "MAPP5", "HOSPBD")
aha$bed.size <- ifelse(aha$HOSPBD >= 400,1,0)
hac <- read.csv("HAC_Data.csv")
names(hac) <- c("PROVIDER_NUMBER","PENALIZED", "SCORE")
mem <- as.data.frame(mem[,c("MCRNUM","MNAME")])
names(mem) <- c("PROVIDER_NUMBER","MNAME")
#Merge data frames
cmi_hac <- merge(hac, cmi, by="PROVIDER_NUMBER")
cmi_hac_aha <- merge(cmi_hac, aha, by="PROVIDER_NUMBER")
table(cmi_hac_aha$PENALIZED)
typeof(cmi_hac_aha$PENALIZED)
typeof(cmi_hac_aha$PENALIZED.BINARY)
table(cmi_hac_aha$PENALIZED.BINARY)
for(i in 1:nrow(cmi_hac_aha$PENALIZED)) {
if(cmi_hac_aha$PENALIZED == "Y"){
cmi_hac_aha$PENALIZED.BINARY <- 1
} else if(cmi_hac_aha$PENALIZED == "N"){
cmi_hac_aha$PENALIZED.BINARY <- 0
} else {
cmi_hac_aha$PENALIZED.BINARY <- NA
}
}
for(i in 1:nrow(cmi_hac_aha)) {
if(cmi_hac_aha$PENALIZED == "Y"){
cmi_hac_aha$PENALIZED.BINARY <- 1
} else if(cmi_hac_aha$PENALIZED == "N"){
cmi_hac_aha$PENALIZED.BINARY <- 0
} else {
cmi_hac_aha$PENALIZED.BINARY <- NA
}
}
warnings()
for(i in 1:nrow(cmi_hac_aha)) {
if(cmi_hac_aha$PENALIZED[i] == "Y"){
cmi_hac_aha$PENALIZED.BINARY[i] <- 1
} else if(cmi_hac_aha$PENALIZED[i] == "N"){
for(i in 1:nrow(cmi_hac_aha)) {
if(cmi_hac_aha$PENALIZED[i] == "Y"){
cmi_hac_aha$PENALIZED.BINARY[i] <- 1
} else if(cmi_hac_aha$PENALIZED[i] == "N"){
cmi_hac_aha$PENALIZED.BINARY[i] <- 0
} else {
cmi_hac_aha$PENALIZED.BINARY[i] <- NA
}
}
View(cmi_hac_aha)
table(cmi_hac_aha$PENALIZED.BINARY)
cmi_hac_aha$MAPP8.BINARY <- ifelse(cmi_hac_aha$MAPP8 == 2,0,1)
cmi_hac_aha$MAPP5.BINARY <- ifelse(cmi_hac_aha$MAPP5 == 2,0,1)
cmi_hac_aha$Test.Set <- sample(0:1,nrow(cmi_hac_aha), replace=TRUE)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MAPP8.BINARY)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MAPP8.BINARY)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
View(cmi_hac_aha)
nrow(hac[which(hac$PENALIZED.BINARY == "1"),])
nrow(hac[which(hac$PENALIZED.BINARY == 1),])
nrow(cmi_hac_aha[which(cmi_hac_aha$PENALIZED.BINARY == 1),])
View(hac)
cmi_hac_aha$bed.size.text <- ifelse(cmi_hac_aha$bed.size == 1,">= 400 Beds","< 400 Beds")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size.text, main="Hospitals Size vs Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP8.BINARY == 1,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING,  main="Teaching Status vs Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,6.7),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
cmi_hac_aha$TEACHING
View(cmi_hac_aha)
table(cmi_hac_aha$MAPP5)
plot(cmi_hac_aha$MAPP5~PENALIZED)
plot(cmi_hac_aha$MAPP5~cmi_hac_aha$PENALIZED)
plot(cmi_hac_aha$MAPP5.BINARY~cmi_hac_aha$PENALIZED)
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP5.BINARY == "Y",1,0)
cmi_hac_aha$TEACHING
cmi_hac_aha$MAPP8
table(cmi_hac_aha$MAPP8)
table(cmi_hac_aha$MAPP5)
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 | cmi_hac_aha$MAPP5.BINARY == 1,1,0)
table(cmi_hac_aha$TEACHING)
table(cmi_hac_aha$TEACHING~cmi_hac_aha$PENALIZED.BINARY)
cmi_hac_aha$PENALIZED.BINARY
table(cmi_hac_aha$PENALIZED.BINARY)
table(cmi_hac_aha$TEACHING,cmi_hac_aha$PENALIZED.BINARY)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
boxplot(cmi_hac_aha$TEACHING~cmi_hac_aha$PENALIZED.BINARY)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING)
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha.full <- sqlQuery(con,"select * from AS12DEM t1
inner join as12svc1 t2 on t1.id = t2.id
inner join as12svc2 t3 on t2.id = t3.id
inner join as12svc3 t4 on t3.id = t4.id
inner join as12UTIL t5 on t4.id = t5.id
inner join as12UTIL2 t6 on t5.id = t6.id")
View(aha.full)
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha.full <- sqlQuery(con,"select * from AS12DEM t1
inner join as12svc1 t2 on t1.id = t2.id
inner join as12svc2 t3 on t2.id = t3.id
inner join as12svc3 t4 on t3.id = t4.id
inner join as12UTIL t5 on t4.id = t5.id
inner join as12UTIL2 t6 on t5.id = t6.id")
odbcClose(con)
rm(con)
View(aha.full)
write.csv(aha.full,file="ahaFULL.csv")
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1,1,0)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
x <- table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
y <- table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
z <- chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
x$residuals
x <- chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
y <- chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
z <- chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
x$residuals
x$stdres
x$observed
x$expected
str(x)
x[['p.value']]
names(x)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$TEACHING)
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$bed.size)
cmi_hac_aha$MEMBER <- ifelse(cmi_hac_aha$PROVIDER_NUMBER %in% mem$PROVIDER_NUMBER,"MEMBER","NON-MEMBER")
chisq.test(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$MEMBER)
View(cmi_hac_aha)
summary(cmi_hac_aha$TACMIV31)
for(i in 1:nrow(cmi_hac_aha)) {
if(cmi_hac_aha$TACMIV31[i] >= 1.664){
cmi_hac_aha$CMI.TIER[i] <- 4
} else if(cmi_hac_aha$TACMIV31[i] >= 1.460){
cmi_hac_aha$CMI.TIER[i] <- 3
} else if(cmi_hac_aha$TACMIV31[i] >= 1.269){
cmi_hac_aha$CMI.TIER[i] <- 2
} else {
cmi_hac_aha$CMI.TIER[i] <- 1
}
}
View(cmi_hac_aha)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$CMI.TIER)
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$CMI.TIER)
rect(0,7,6,11, col=col2alpha("red", alpha = 0.2))
a <- cut(cmi_hac_aha$TACMIV31, 7)
a <- cut(cmi_hac_aha$TACMIV31, 8)
boxplot(cmi_hac_aha$SCORE ~ a)
View(hac)
table(hac$PENALIZED)
hist(cmi_hac_aha$TACMIV31)
layout(matrix(1:2, ncol=2))
hist(cmi_hac_aha$TACMIV31)
boxplot(cmi_hac_aha$SCORE ~ a)
layout(matrix(2:1, ncol=1))
boxplot(cmi_hac_aha$SCORE ~ a)
hist(cmi_hac_aha$TACMIV31)
layout(matrix(1:2, ncol=1))
layout(matrix(1:2, ncol=1))
hist(cmi_hac_aha$TACMIV31)
table(cmi_hac_aha$PENALIZED.BINARY ~ cmi_hac_aha$CMI.TIER)
table(cmi_hac_aha$PENALIZED.BINARY ~ cmi_hac_aha$CMI.TIER)
plot(cmi_hac_aha$PENALIZED.BINARY ~ cmi_hac_aha$CMI.TIER)
boxplot(cmi_hac_aha$PENALIZED.BINARY ~ cmi_hac_aha$CMI.TIER)
table(cmi_hac_aha$PENALIZED.BINARY ~ cmi_hac_aha$CMI.TIER)
traceback()
cmi_hac_aha$CMI.TIER
table(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$CMI.TIER)
install.packages("gmodels")
library(gmodels)
kable(CrossTable(cmi_hac_aha$PENALIZED.BINARY, cmi_hac_aha$CMI.TIER, chisq=F,prop.r=F,prop.c=F,prop.t=F,), format = "markdown")
tab <- rbind(c("Not Penalized", 686,641,628,565),c("Penalized",134,166,188,255))
View(tab)
names(tab) <- c("Penalty", "1","2","3","4")
View(tab)
names(tab) <- c("Penalty", "1","2","3","4")
names(tab)
View(tab)
cmi_hac_aha$bed.size.text <- ifelse(cmi_hac_aha$bed.size == 1,">= 400 Beds","< 400 Beds")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$bed.size.text, main="Hospitals Size vs Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,6.05),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 1],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$bed.size == 0],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1 ,"Teaching","Other")
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$TEACHING,  main="Teaching Status vs Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,6.7),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING == "Teaching"],)))
text(4.85,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$TEACHING ==  "Other"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
boxplot(cmi_hac_aha$SCORE ~ cmi_hac_aha$MEMBER, main="Member vs Non-Member Total HAC Score", ylab="Scores")
abline(h=7, col="red")
text(c(0,5),paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "NON-MEMBER"],)))
text(6.7,paste("Median: ",median(cmi_hac_aha$SCORE[cmi_hac_aha$MEMBER == "MEMBER"],)))
rect(0,7,4,11, col=col2alpha("red", alpha = 0.2))
text(1.5,9,"Penalized", cex=1.5)
setwd("~/GIT Repos/HAC Reduction Penalties")
library(RODBC)
library(seqinr)
library(gmodels)
#Connect to SQL Databases and read in data
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha <- sqlQuery(con,"select t1.ID,MNAME, MCRNUM, MAPP8, MAPP5, t2.HOSPBD  from AS12DEM t1 inner join as12svc1 t2 on t1.id = t2.id")
odbcClose(con)
rm(con)
con <- odbcConnect("MemberList",uid="SASUser", pwd="EHI1301a")
mem <- sqlQuery(con,"select * from AEH_Current_Members")
odbcClose(con)
rm(con)
con <- odbcConnect("IPPSData",uid="SASUser", pwd="EHI1301a")
cmi <- sqlQuery(con,"select PROVIDER_NUMBER, HOSPITAL, TACMIV31 from FY2014IMPACT")
odbcClose(con)
rm(con)
#Read in HAC_Data.csv; rename matching variables in data frames
names(aha) <- c("ID","MNAME","PROVIDER_NUMBER", "MAPP8", "MAPP5", "HOSPBD")
aha$bed.size <- ifelse(aha$HOSPBD >= 400,1,0)
hac <- read.csv("HAC_Data.csv")
names(hac) <- c("PROVIDER_NUMBER","PENALIZED", "SCORE")
mem <- as.data.frame(mem[,c("MCRNUM","MNAME")])
names(mem) <- c("PROVIDER_NUMBER","MNAME")
#Merge data frames
cmi_hac <- merge(hac, cmi, by="PROVIDER_NUMBER")
cmi_hac_aha <- merge(cmi_hac, aha, by="PROVIDER_NUMBER")
#Recode PENALIZED Variable
for(i in 1:nrow(cmi_hac_aha)) {
if(cmi_hac_aha$PENALIZED[i] == "Y"){
cmi_hac_aha$PENALIZED.BINARY[i] <- 1
} else if(cmi_hac_aha$PENALIZED[i] == "N"){
cmi_hac_aha$PENALIZED.BINARY[i] <- 0
} else {
cmi_hac_aha$PENALIZED.BINARY[i] <- NA
}
}
#Recode MAPP8 and MAPP5
cmi_hac_aha$MAPP8.BINARY <- ifelse(cmi_hac_aha$MAPP8 == 2,0,1)
cmi_hac_aha$MAPP5.BINARY <- ifelse(cmi_hac_aha$MAPP5 == 2,0,1)
cmi_hac_aha$Test.Set <- sample(0:1,nrow(cmi_hac_aha), replace=TRUE)
#Combine as Teaching
cmi_hac_aha$TEACHING <- ifelse(cmi_hac_aha$MAPP8.BINARY == 1,1,0)
#Connect to SQL Databases and read in data
con <- odbcConnect("AHA",uid="SASUser", pwd="EHI1301a")
aha <- sqlQuery(con,"select t1.ID,MNAME, MCRNUM, MAPP8, MAPP5, t2.HOSPBD  from AS12DEM t1 inner join as12svc1 t2 on t1.id = t2.id")
odbcClose(con)
rm(con)
con <- odbcConnect("MemberList",uid="SASUser", pwd="EHI1301a")
mem <- sqlQuery(con,"select * from AEH_Current_Members")
odbcClose(con)
rm(con)
con <- odbcConnect("IPPSData",uid="SASUser", pwd="EHI1301a")
cmi <- sqlQuery(con,"select PROVIDER_NUMBER, HOSPITAL, TACMIV31 from FY2014IMPACT")
odbcClose(con)
rm(con)
write.csv(aha,path="aha.csv")
write.csv(aha,file="aha.csv")
write.csv(cmi,file="cmi.csv")
write.csv(mem,file="mem.csv")
